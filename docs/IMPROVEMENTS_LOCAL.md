# æœ¬åœ°å¼€å‘å·¥å…·æ”¹è¿›å»ºè®®

## ğŸ¯ åº”ç”¨å®šä½

**åº”ç”¨ç±»å‹ï¼š** æœ¬åœ°å¼€å‘å·¥å…·ï¼ˆä»… localhost è®¿é—®ï¼‰  
**ä½¿ç”¨åœºæ™¯ï¼š** ä¸ªäººæˆ–å›¢é˜Ÿæœ¬åœ°é¡¹ç›®ç®¡ç†  
**éƒ¨ç½²æ–¹å¼ï¼š** æœ¬åœ°è¿è¡Œï¼Œä¸å¯¹å¤–æä¾›æœåŠ¡

## ğŸ“Š é‡æ–°è¯„ä¼°çš„ä¼˜å…ˆçº§

### âœ… å½“å‰å·²å…·å¤‡ï¼ˆéå¸¸é€‚åˆæœ¬åœ°å·¥å…·ï¼‰

| åŠŸèƒ½ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **æ¨¡å—åŒ–æ¶æ„** | â­â­â­â­â­ | æ¸…æ™°çš„ä»£ç ç»“æ„ |
| **æ—¥å¿—ç³»ç»Ÿ** | â­â­â­â­â­ | å®Œå–„çš„æ—¥å¿—è®°å½•å’ŒæŸ¥çœ‹ |
| **API æ–‡æ¡£** | â­â­â­â­â­ | Swagger ä¾¿äºè°ƒè¯• |
| **SQLite æ•°æ®åº“** | â­â­â­â­â­ | å®Œç¾é€‚åˆæœ¬åœ°å·¥å…·ï¼Œæ— éœ€é¢å¤–é…ç½® |
| **é…ç½®ç®¡ç†** | â­â­â­â­ | ç¯å¢ƒå˜é‡æ”¯æŒ |
| **å¼‚å¸¸å¤„ç†** | â­â­â­â­ | è‰¯å¥½çš„é”™è¯¯æç¤º |

### ğŸ¯ çœŸæ­£éœ€è¦çš„åŠŸèƒ½ï¼ˆæœ¬åœ°å·¥å…·è§†è§’ï¼‰

## ğŸŸ¢ ä¸€çº§ä¼˜å…ˆçº§ï¼ˆæå‡å¼€å‘ä½“éªŒï¼‰

### 1. **æ•°æ®æŒä¹…åŒ–ä¼˜åŒ–** â­â­â­â­â­

**å½“å‰é—®é¢˜ï¼š**
- ä½¿ç”¨ `synchronize: true` å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±
- æ²¡æœ‰æ•°æ®å¤‡ä»½æœºåˆ¶
- æ•°æ®è¿ç§»å›°éš¾

**å»ºè®®å®ç°ï¼š**
- âœ… é…ç½®æ•°æ®åº“è¿ç§»ï¼ˆTypeORM migrationsï¼‰
- âœ… æ·»åŠ æ•°æ®å¤‡ä»½/æ¢å¤åŠŸèƒ½
- âœ… æ•°æ®å¯¼å‡º/å¯¼å…¥ï¼ˆJSON/CSVï¼‰

**ä¸ºä»€ä¹ˆé‡è¦ï¼š** æœ¬åœ°å·¥å…·æœ€æ€•çš„å°±æ˜¯æ•°æ®ä¸¢å¤±ï¼Œè¿™æ¯”å®‰å…¨æ€§é‡è¦å¾—å¤šï¼

**å®æ–½éš¾åº¦ï¼š** â­â­â­ (3-5å¤©)

---

### 2. **é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ** â­â­â­â­â­

**å½“å‰é—®é¢˜ï¼š**
- å‰ç«¯å¯èƒ½ä¸çŸ¥é“åç«¯å‡ºäº†ä»€ä¹ˆé”™
- æ²¡æœ‰å‹å¥½çš„é”™è¯¯æç¤º

**å»ºè®®å®ç°ï¼š**
- âœ… ç»Ÿä¸€çš„é”™è¯¯ç ä½“ç³»
- âœ… å‹å¥½çš„ä¸­æ–‡é”™è¯¯æ¶ˆæ¯
- âœ… å‰ç«¯é”™è¯¯æç¤ºä¼˜åŒ–

**ä¸ºä»€ä¹ˆé‡è¦ï¼š** æœ¬åœ°å·¥å…·è¦è®©ç”¨æˆ·æ¸…æ¥šçŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆ

**å®æ–½éš¾åº¦ï¼š** â­â­ (2-3å¤©)

---

### 3. **å•å…ƒæµ‹è¯•ï¼ˆé€‰æ‹©æ€§ï¼‰** â­â­â­â­

**å½“å‰çŠ¶æ€ï¼š** æµ‹è¯•è¦†ç›–ç‡å¾ˆä½

**å»ºè®®å®ç°ï¼š**
- âœ… æ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„å•å…ƒæµ‹è¯•
- âœ… å…³é”®æ¥å£çš„ E2E æµ‹è¯•
- âŒ ä¸éœ€è¦ 100% è¦†ç›–ç‡

**ä¸ºä»€ä¹ˆé‡è¦ï¼š** é˜²æ­¢ä¿®æ”¹ä»£ç æ—¶ç ´åç°æœ‰åŠŸèƒ½

**å®æ–½éš¾åº¦ï¼š** â­â­â­ (æŒç»­è¿›è¡Œ)

---

## ğŸŸ¡ äºŒçº§ä¼˜å…ˆçº§ï¼ˆåŠŸèƒ½å¢å¼ºï¼‰

### 4. **é¡¹ç›®é…ç½®æŒä¹…åŒ–** â­â­â­â­

**å»ºè®®å®ç°ï¼š**
- é¡¹ç›®å¯åŠ¨å‘½ä»¤é…ç½®
- é¡¹ç›®ç¯å¢ƒå˜é‡ç®¡ç†
- é¡¹ç›®è‡ªå®šä¹‰è„šæœ¬

**ä¸ºä»€ä¹ˆé‡è¦ï¼š** æå‡é¡¹ç›®ç®¡ç†èƒ½åŠ›

**å®æ–½éš¾åº¦ï¼š** â­â­â­ (1å‘¨)

---

### 5. **é¡¹ç›®å¯åŠ¨/åœæ­¢ç®¡ç†**ï¼ˆå¯é€‰ï¼‰â­â­â­â­

**å»ºè®®å®ç°ï¼š**
- ç›´æ¥ä»ç•Œé¢å¯åŠ¨é¡¹ç›®
- æŸ¥çœ‹é¡¹ç›®è¿è¡ŒçŠ¶æ€
- æŸ¥çœ‹é¡¹ç›®æ§åˆ¶å°è¾“å‡º

**ä¸ºä»€ä¹ˆé‡è¦ï¼š** çœŸæ­£çš„é¡¹ç›®ç®¡ç†å·¥å…·

**å®æ–½éš¾åº¦ï¼š** â­â­â­â­ (1-2å‘¨)

---

### 6. **æœç´¢å’Œè¿‡æ»¤å¢å¼º** â­â­â­

**å»ºè®®å®ç°ï¼š**
- é¡¹ç›®æœç´¢
- æŒ‰æ ‡ç­¾/ç±»å‹è¿‡æ»¤
- æ”¶è—/å¸¸ç”¨é¡¹ç›®

**ä¸ºä»€ä¹ˆé‡è¦ï¼š** é¡¹ç›®å¤šäº†ä¹‹åæ–¹ä¾¿æŸ¥æ‰¾

**å®æ–½éš¾åº¦ï¼š** â­â­ (3-5å¤©)

---

### 7. **é¡¹ç›®ç»Ÿè®¡ä¿¡æ¯** â­â­â­

**å»ºè®®å®ç°ï¼š**
- é¡¹ç›®ä»£ç è¡Œæ•°ç»Ÿè®¡
- ä¾èµ–ç‰ˆæœ¬æ£€æŸ¥
- Git çŠ¶æ€æ˜¾ç¤º

**ä¸ºä»€ä¹ˆé‡è¦ï¼š** å¿«é€Ÿäº†è§£é¡¹ç›®çŠ¶æ€

**å®æ–½éš¾åº¦ï¼š** â­â­â­ (1å‘¨)

---

## ğŸ”µ ä¸‰çº§ä¼˜å…ˆçº§ï¼ˆé”¦ä¸Šæ·»èŠ±ï¼‰

### 8. **ä¸»é¢˜é…ç½®** â­â­

**å»ºè®®å®ç°ï¼š**
- æ·±è‰²/æµ…è‰²ä¸»é¢˜
- è‡ªå®šä¹‰é…è‰²

**å®æ–½éš¾åº¦ï¼š** â­â­ (å‰ç«¯ä¸ºä¸»)

---

### 9. **å¿«æ·é”®æ”¯æŒ** â­â­

**å»ºè®®å®ç°ï¼š**
- å¿«é€Ÿæœç´¢é¡¹ç›®
- å¿«é€Ÿå¯åŠ¨é¡¹ç›®
- å…¨å±€å¿«æ·é”®

**å®æ–½éš¾åº¦ï¼š** â­â­ (å‰ç«¯ä¸ºä¸»)

---

### 10. **ç³»ç»Ÿæ‰˜ç›˜é›†æˆ**ï¼ˆæ¡Œé¢åº”ç”¨ï¼‰â­â­

å¦‚æœæœªæ¥åšæˆ Electron åº”ç”¨çš„è¯

---

## âŒ æœ¬åœ°å·¥å…·ä¸éœ€è¦çš„åŠŸèƒ½

### è®¤è¯æˆæƒç³»ç»Ÿ âŒ

**ä¸ºä»€ä¹ˆä¸éœ€è¦ï¼š**
- ä»…æœ¬åœ°è®¿é—®ï¼Œæ²¡æœ‰å®‰å…¨å¨èƒ
- å¢åŠ ä½¿ç”¨å¤æ‚åº¦
- æ¯æ¬¡éƒ½è¦ç™»å½•å¾ˆéº»çƒ¦

**æ›¿ä»£æ–¹æ¡ˆï¼š** å¦‚æœæ‹…å¿ƒå®‰å…¨ï¼Œå¯ä»¥ï¼š
- åªç›‘å¬ `127.0.0.1`ï¼ˆå·²ç»æ˜¯è¿™æ ·ï¼‰
- æ·»åŠ ç®€å•çš„å¯åŠ¨å¯†ç ï¼ˆå¯é€‰ï¼‰

---

### API é™æµ âŒ

**ä¸ºä»€ä¹ˆä¸éœ€è¦ï¼š**
- æœ¬åœ°ä½¿ç”¨ä¸ä¼šæœ‰ DDoS æ”»å‡»
- è‡ªå·±æ”»å‡»è‡ªå·±æ²¡æœ‰æ„ä¹‰
- é™æµåè€Œå½±å“ä½“éªŒ

**ä¾‹å¤–ï¼š** å¦‚æœæœ‰è€—æ—¶æ“ä½œï¼ˆå¦‚å¤§é‡æ–‡ä»¶æ‰«æï¼‰ï¼Œå¯ä»¥ç”¨é˜Ÿåˆ—æ§åˆ¶ï¼Œä½†ä¸æ˜¯é™æµã€‚

---

### ç¼“å­˜ç³»ç»Ÿï¼ˆRedisï¼‰âŒ

**ä¸ºä»€ä¹ˆä¸éœ€è¦ï¼š**
- æœ¬åœ°æ•°æ®é‡å°ï¼ŒSQLite å·²ç»å¤Ÿå¿«
- Redis éœ€è¦é¢å¤–å®‰è£…å’Œé…ç½®
- å¢åŠ å¤æ‚åº¦

**æ›¿ä»£æ–¹æ¡ˆï¼š**
- å†…å­˜ç¼“å­˜ï¼ˆç®€å•çš„ Mapï¼‰å³å¯
- æˆ–è€…ä½¿ç”¨ `@nestjs/cache-manager` çš„å†…å­˜å­˜å‚¨

---

### å¾®æœåŠ¡æ¶æ„ âŒ

**ä¸ºä»€ä¹ˆä¸éœ€è¦ï¼š**
- æœ¬åœ°å·¥å…·å•ä½“åº”ç”¨æœ€ç®€å•
- å¾®æœåŠ¡å¢åŠ å¤æ‚åº¦
- æ²¡æœ‰é«˜å¹¶å‘éœ€æ±‚

---

### è´Ÿè½½å‡è¡¡/é›†ç¾¤ âŒ

æ˜¾ç„¶ä¸éœ€è¦

---

## ğŸ“‹ æ¨èå®æ–½è®¡åˆ’

### é˜¶æ®µ 1ï¼šæ•°æ®å®‰å…¨ï¼ˆæœ¬å‘¨ï¼‰

```bash
# 1. é…ç½®æ•°æ®åº“è¿ç§»
npm run typeorm migration:generate -- -n InitialSchema

# 2. æ·»åŠ æ•°æ®å¤‡ä»½åŠŸèƒ½
# å®ç°ä¸€ä¸ªç®€å•çš„å¤‡ä»½æ¥å£ï¼Œå¯¼å‡º SQLite æ–‡ä»¶
```

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] é…ç½® TypeORM è¿ç§»
- [ ] å…³é—­ `synchronize: true`
- [ ] æ·»åŠ æ•°æ®å¤‡ä»½æ¥å£
- [ ] æ·»åŠ æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼ˆJSONï¼‰

**é¢„è®¡æ—¶é—´ï¼š** 3-5 å¤©

---

### é˜¶æ®µ 2ï¼šä½“éªŒä¼˜åŒ–ï¼ˆ2å‘¨å†…ï¼‰

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] ä¼˜åŒ–é”™è¯¯æç¤º
- [ ] æ·»åŠ é¡¹ç›®æœç´¢
- [ ] æ·»åŠ é¡¹ç›®æ ‡ç­¾/åˆ†ç±»
- [ ] æ”¹è¿› API æ–‡æ¡£

**é¢„è®¡æ—¶é—´ï¼š** 1-2 å‘¨

---

### é˜¶æ®µ 3ï¼šåŠŸèƒ½å¢å¼ºï¼ˆ1ä¸ªæœˆå†…ï¼‰

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] é¡¹ç›®é…ç½®ç®¡ç†
- [ ] é¡¹ç›®ç»Ÿè®¡ä¿¡æ¯
- [ ] Git çŠ¶æ€é›†æˆ
- [ ] ä¾èµ–æ£€æŸ¥

**é¢„è®¡æ—¶é—´ï¼š** 2-3 å‘¨

---

### é˜¶æ®µ 4ï¼šé«˜çº§åŠŸèƒ½ï¼ˆæŒ‰éœ€ï¼‰

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] é¡¹ç›®å¯åŠ¨/åœæ­¢ç®¡ç†
- [ ] ç»ˆç«¯é›†æˆ
- [ ] ä¸»é¢˜é…ç½®
- [ ] å¿«æ·é”®æ”¯æŒ

**é¢„è®¡æ—¶é—´ï¼š** æŒ‰éœ€å¼€å‘

---

## ğŸ”§ ç«‹å³å¯ä»¥åšçš„æ”¹è¿›ï¼ˆæœ¬å‘¨ï¼‰

### 1. æ·»åŠ æ•°æ®å¤‡ä»½æ¥å£

```typescript
// src/system/system.controller.ts
@Get('backup')
@ApiOperation({ summary: 'å¤‡ä»½æ•°æ®åº“' })
async backup(@Res() res: Response) {
  const dbPath = path.join(process.cwd(), 'data/ldesign.db');
  const backupPath = path.join(
    process.cwd(), 
    `data/backups/ldesign_${Date.now()}.db`
  );
  
  fs.copyFileSync(dbPath, backupPath);
  res.download(backupPath);
}
```

### 2. æ·»åŠ æ•°æ®å¯¼å‡º

```typescript
@Get('export')
@ApiOperation({ summary: 'å¯¼å‡ºæ‰€æœ‰æ•°æ®ä¸º JSON' })
async exportData() {
  const projects = await this.projectsService.findAll();
  const users = await this.usersService.findAll();
  
  return {
    version: '1.0',
    exportTime: new Date().toISOString(),
    data: { projects, users },
  };
}
```

### 3. æ”¹è¿›é”™è¯¯æ¶ˆæ¯

```typescript
// src/common/exceptions/business-error.codes.ts
export const ErrorCodes = {
  PROJECT_NOT_FOUND: {
    code: 'P001',
    message: 'æ‰¾ä¸åˆ°è¯¥é¡¹ç›®ï¼Œå¯èƒ½å·²è¢«åˆ é™¤',
  },
  PROJECT_PATH_EXISTS: {
    code: 'P002', 
    message: 'è¯¥é¡¹ç›®è·¯å¾„å·²è¢«å¯¼å…¥ï¼Œè¯·å‹¿é‡å¤æ·»åŠ ',
  },
  // ...
};
```

### 4. ç¦ç”¨ä¸å¿…è¦çš„ CORSï¼ˆå®‰å…¨æ€§æå‡ï¼‰

```typescript
// src/main.ts
app.enableCors({
  origin: ['http://localhost:8888'], // åªå…è®¸ä½ çš„å‰ç«¯åœ°å€
  credentials: true,
});
```

---

## ğŸ§ª æ¨èçš„æµ‹è¯•ç­–ç•¥

å¯¹äºæœ¬åœ°å·¥å…·ï¼Œä¸éœ€è¦è¿½æ±‚ 100% æµ‹è¯•è¦†ç›–ç‡ï¼Œé‡ç‚¹æµ‹è¯•ï¼š

### æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

```typescript
// é¡¹ç›®å¯¼å…¥é€»è¾‘
describe('ProjectsService.importProject', () => {
  it('should import a valid project', async () => {
    // æµ‹è¯•æ­£å¸¸å¯¼å…¥
  });
  
  it('should reject duplicate project path', async () => {
    // æµ‹è¯•é‡å¤è·¯å¾„
  });
});
```

### å…³é”®æ¥å£

```typescript
// E2E æµ‹è¯•
describe('Projects API', () => {
  it('/api/v1/projects (GET)', () => {
    return request(app.getHttpServer())
      .get('/api/v1/projects')
      .expect(200);
  });
});
```

**ç›®æ ‡è¦†ç›–ç‡ï¼š** 50-70% å³å¯ï¼ˆé‡ç‚¹æ˜¯æ ¸å¿ƒåŠŸèƒ½ï¼‰

---

## ğŸ’¾ æ•°æ®è¿ç§»é…ç½®ï¼ˆä¼˜å…ˆï¼ï¼‰

### 1. åˆ›å»ºè¿ç§»é…ç½®

```typescript
// ormconfig.ts
import { DataSource } from 'typeorm';

export default new DataSource({
  type: 'sqlite',
  database: 'data/ldesign.db',
  entities: ['src/**/*.entity.ts'],
  migrations: ['src/migrations/*.ts'],
});
```

### 2. æ·»åŠ è¿ç§»è„šæœ¬

```json
// package.json
{
  "scripts": {
    "typeorm": "typeorm-ts-node-commonjs",
    "migration:generate": "npm run typeorm -- migration:generate",
    "migration:run": "npm run typeorm -- migration:run",
    "migration:revert": "npm run typeorm -- migration:revert"
  }
}
```

### 3. å…³é—­è‡ªåŠ¨åŒæ­¥

```typescript
// app.module.ts
TypeOrmModule.forRoot({
  type: 'sqlite',
  database: 'data/ldesign.db',
  entities: [__dirname + '/**/*.entity{.ts,.js}'],
  synchronize: false, // âœ… å…³é—­è‡ªåŠ¨åŒæ­¥
  migrations: ['dist/migrations/*.js'],
  migrationsRun: true, // âœ… å¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œè¿ç§»
}),
```

---

## ğŸ“ æ€»ç»“

### å¯¹äºæœ¬åœ°å¼€å‘å·¥å…·ï¼ŒçœŸæ­£é‡è¦çš„æ˜¯ï¼š

1. âœ… **æ•°æ®ä¸ä¸¢å¤±**ï¼ˆæœ€é‡è¦ï¼ï¼‰
2. âœ… **ä½¿ç”¨æ–¹ä¾¿**ï¼ˆæ— éœ€å¤æ‚é…ç½®ï¼‰
3. âœ… **åŠŸèƒ½å®ç”¨**ï¼ˆçœŸæ­£å¸®åŠ©å¼€å‘ï¼‰
4. âœ… **é”™è¯¯æ¸…æ™°**ï¼ˆçŸ¥é“å‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼‰
5. âœ… **æ€§èƒ½å¤Ÿç”¨**ï¼ˆæœ¬åœ°æ•°æ®é‡ä¸å¤§ï¼‰

### ä¸éœ€è¦çš„ä¸œè¥¿ï¼š

1. âŒ å¤æ‚çš„è®¤è¯ç³»ç»Ÿ
2. âŒ API é™æµ
3. âŒ Redis ç¼“å­˜
4. âŒ å¾®æœåŠ¡æ¶æ„
5. âŒ è´Ÿè½½å‡è¡¡

### æœ€æ¨èçš„æ”¹è¿›é¡ºåºï¼š

1. **æ•°æ®åº“è¿ç§»é…ç½®**ï¼ˆé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼‰â­â­â­â­â­
2. **æ•°æ®å¤‡ä»½åŠŸèƒ½**ï¼ˆå®‰å…¨æ„Ÿï¼‰â­â­â­â­â­
3. **é”™è¯¯æç¤ºä¼˜åŒ–**ï¼ˆç”¨æˆ·ä½“éªŒï¼‰â­â­â­â­
4. **æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•**ï¼ˆä»£ç è´¨é‡ï¼‰â­â­â­â­
5. **æœç´¢å’Œè¿‡æ»¤**ï¼ˆåŠŸèƒ½å¢å¼ºï¼‰â­â­â­

---

## ğŸ“– å‚è€ƒæ–‡æ¡£

- [TypeORM Migrations](https://typeorm.io/migrations)
- [NestJS Testing](https://docs.nestjs.com/fundamentals/testing)
- [SQLite Backup](https://www.sqlite.org/backup.html)
